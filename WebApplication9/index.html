<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="Content/bootstrap.css" rel="stylesheet" />
    <link href="Content/bootstrap-theme.css" rel="stylesheet" />

    <script src="Scripts/jquery-1.9.1.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script type="text/html" id="tabletemplate">
        <tr>
            <td>
                <input type="checkbox" name="sid[]" value="{{Id}}" />
            </td>
            <td>{{Name}}</td>
        </tr>
    </script>

    <!-- Tareeqa no 2 -->
    <!--<script type="text/html" id="optiontemplate">
        <option value="{{batchcode}}">{{batchcode}}</option>
    </script>-->
    <script>
        function GetAllBatches() {
            /// ssaray batches server say laa kar drop down may show kar do.

            var batchddl = document.getElementById('batchddl');

            var xhr = new XMLHttpRequest();
            xhr.open("Get", "api/GetAllBatches");

            xhr.onload = function () {

                if (xhr.response && xhr.response != '') {
                    var batches = JSON.parse(xhr.response);

                    for (var i = 0; i < batches.length; i++) {

                        var batch = batches[i].Name;

                        batchddl.innerHTML += '<option value="' + batch + '">' + batch + '</option>';
                    }
                }
            };
            xhr.send();

            //var batches = [
            //    { batch: 'ipro-201412E', id: 1 },
            //    { batch: 'ipro-201503C', id: 2 },
            //    { batch: 'ipro-201608B', id: 3 },
            //];


            ///tareeqa no 2
            //var template = document.getElementById('optiontemplate').innerHTML;
            //batchddl.innerHTML +=  template.replace('{{batchcode}}', batch).replace('{{batchcode}}', batch);



            ///pehla tareeqa
            //var option1 = document.createElement('option');
            //option1.value = batch;
            //option1.text = batch;

            //batchddl.appendChild(option1);
        }
        $(document).ready(function () {

            // jaisay hi poage load ho jai poora. tu forun
            //yeh neechay wala function call ho jai.
            GetAllBatches()
        });

        function batch_onchange(batchddl) {
            // jaisay hi batch kay drop down say batch change ho ga.
            // hum uss batch kay students ko server say lay aain gay.
            //oor hum table may tr td bana kay saaray students ko show kar day gain.

            var selectedbatch = batchddl.value;

            var xhr = new XMLHttpRequest();
            xhr.open("Get", "api/GetStudents/" + batchddl.value);         


            xhr.onload = function ()
            {
                if (xhr.response && xhr.response != '') {
                    var tabletemplate = document.getElementById('tabletemplate').innerHTML;
                    
                    var studenttbody = document.getElementById('studenttbody');
                    var students = JSON.parse(xhr.response);
                    studenttbody.innerHTML = "";
                    for (var i = 0; i < students.length; i++) {
                        var student = students[i];                      

                        studenttbody.innerHTML += tabletemplate.replace('{{Id}}', student.Id).replace('{{Name}}', student.Name);
                    }
                }
            };
            xhr.send();
        }

        function MarkAttandance() {
            //saary woh students jinn ko aap nay check box say select kia hay.
            // unn ko post kar do do sever per takay unhen ki attandacne mark ho jai.

        }


    </script>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label>Batch</label>
                    <select onchange="batch_onchange(this)" id="batchddl" class="form-control">
                        <option value="-1">Select..</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <table class="table table-responsive table-bordered">
                    <thead>
                        <tr>
                            <th><input type="checkbox" name="selectall" value="" /></th>
                            <th>Name</th>
                        </tr>
                    </thead>
                    <tbody id="studenttbody">

                    </tbody>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <input type="button" class="btn-primary btn btn-block" name="name" value="Mark Attandance" />
            </div>
        </div>
    </div>
</body>
</html>
